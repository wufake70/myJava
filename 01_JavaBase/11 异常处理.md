# 异常处理

**一、异常的基本概念**
- **异常的定义**：
    - 程序在执行过程中出现的非正常情况，若不处理最终会导致JVM的非正常停止。
- **异常的抛出机制**：
    - Java将不同异常用不同类表示，发生异常时创建该异常类型的对象并抛出（throw）。程序员可捕获（catch）该对象并处理，未捕获则会导致程序终止。
- **如何对待异常**：
    - 两种解决方法：
        - 遇到错误终止程序运行。
        - 编写程序时充分考虑各种异常和错误，尽力预防和避免，无法避免时编写代码进行异常检测和处理，保证代码健壮性。

**二、异常的体系结构**
- **java.lang.Throwable**：异常体系的根父类
    - **java.lang.Error**：
        - Java虚拟机无法解决的严重问题，如JVM系统内部错误、资源耗尽等严重情况，一般不编写针对性代码处理。
        - 示例：StackOverflowError、OutOfMemoryError。
    - **java.lang.Exception**：
        - 可以编写针对性代码处理。
        - **编译时异常（受检异常）**：
            - 执行javac.exe命令时出现的异常，如ClassNotFoundException、FileNotFoundException、IOException。
        - **运行时异常（非受检异常）**：
            - 执行java.exe命令时出现的异常，如ArrayIndexOutOfBoundsException、NullPointerException、ClassCastException、NumberFormatException、InputMismatchException、ArithmeticException。

**三、异常处理方式一：抓抛模型（try-catch-finally）**
- **过程**：
    - **抛**：
        - 程序执行中出现异常，在异常代码处生成对应异常类的对象并抛出，抛出后其后代码不执行。
    - **抓**：
        - 对抛出的异常对象进行捕获处理，处理后代码可继续执行。
- **基本结构**：
```java
try{
    //可能产生异常的代码
}
catch( 异常类型1 e ){
    //当产生异常类型1型异常时的处置措施
}
catch( 异常类型2 e ){
    //当产生异常类型2型异常时的处置措施
}
finally{
    //无论是否发生异常，都无条件执行的语句
}
```
- **使用细节**：
    - 将可能出现异常的代码声明在try语句中，出现异常会自动生成对应异常类对象并抛出。
    - 对try中抛出的异常对象，使用catch语句匹配，匹配上进入catch语句块处理，处理后可继续向下执行。
    - 多个catch结构中，不存在子父类关系时声明顺序随意，存在子父类关系时必须将子类声明在父类上面，否则报错。
    - catch中异常处理的方式：
        - 自己编写输出语句。
        - printStackTrace()：打印异常的详细信息（推荐）。
        - getMessage()：获取发生异常的原因。
    - try中声明的变量出了try结构不可调用。
    - try-catch结构可嵌套使用。
- **开发体会**：
    - 对于运行时异常，开发中通常不进行显式处理，出现异常根据提示信息修改代码。
    - 对于编译时异常，必须处理，否则编译不通过。

**四、finally的使用说明**
- **finally的理解**：
    - 将一定要执行的代码声明在finally结构中。
    - 无论try或catch中是否存在未处理异常或return语句等，finally中声明的语句都一定执行。
    - finally语句和catch语句是可选的，但finally不能单独使用。
- **需声明在finally中的代码**：
    - 开发中使用资源（如输入流、输出流、数据库连接、Socket连接等），使用完必须显式关闭，否则会导致内存泄漏，为保证资源使用完能关闭，需将关闭操作声明在finally中。

**五、面试题：final、finally、finalize的区别**


**六、异常处理的方式二：throws**
- **格式**：
    - 在方法的声明处使用"throws 异常类型1,异常类型2,..."。
```java
public void test() throws 异常类型1,异常类型2,.. {
    //可能存在编译时异常
}
```
- **是否真正处理了异常**：
    - 从编译角度看，可视为给出异常出现时的解决方案，即继续向上抛出（throws），但此方式仅将异常抛给调用者，调用者仍需考虑如何处理，不算真正处理异常。
- **方法重写的要求（针对编译时异常）**：
    - 子类重写的方法抛出的异常类型可以与父类被重写的方法抛出的异常类型相同，或是父类被重写的方法抛出的异常类型的子类。
- **开发中异常处理方式的选择**：
    - 涉及资源调用（流、数据库连接、网络连接等），使用try-catch-finally处理，避免内存泄漏。
    - 父类被重写的方法未throws异常类型，子类重写的方法出现异常只能使用try-catch-finally处理，不能throws。
    - 方法a依次调用方法b、c、d，b、c、d间是递进关系，若b、c、d中有异常，通常b、c、d使用throws，方法a使用try-catch-finally。